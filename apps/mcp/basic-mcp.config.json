{
    "data" : {
        "opscotch-mcp-version" : "0.0.1"
    },
    "workflows": [
        {
            "enabled" : true,
            "name": "opscotch cors",
            "steps": [
                {
                    "enabled" : "true",
                    "stepId" : "cors",
                    "trigger" : {
                        "http" : {
                            "server" : "mcp",
                            "method" : "OPTIONS",
                            "path" : ".*"
                        }
                    },
                    "data" : {
                        "addHeaders" : [ "Access-Control-Allow-Methods", "Access-Control-Allow-Origin", "Access-Control-Allow-Headers" ],
                        "Access-Control-Allow-Methods" : "POST",
                        "Access-Control-Allow-Origin" : "*",
                        "Access-Control-Allow-Headers" : "content-type"
                    },
                    "resultsProcessor" : {
                        "processors" : [
                            {
                                "resource" : "/general/standard-clear-body.js"
                            },
                            {
                                "resource" : "/httpserver/response-set-cors.js"
                            },
                            {
                                "script" : "context.setProperty(\"status_code\", \"204\")"
                            }
                        ]
                    }
                }
            ]
        },
        {
            "enabled" : true,
            "name": "opscotch MCP JSONRPC handler",
            "steps": [
                {
                    "enabled" : "true",
                    "stepId" : "mcp",
                    "trigger" : {
                        "http" : {
                            "server" : "mcp",
                            "path" : "/mcp",
                            "method" : "POST"
                        }
                    },
                    "resultsProcessor" : {
                        "processors" : [
                            {
                                "resource" : "/httpserver/response-set-cors.js"
                            },
                            {
                                "script" : "context.setBody(JSON.stringify( JSON.parse(JSON.parse(context.getBody()).body)));"
                            },
                            {
                                "script" : "console.log(`received: ${context.getBody()}`)"
                            },
                            {
                                "resource" : "/apps/mcp/jsonrpc.js"
                            },
                            {
                                "script" : "console.log(`responding: ${context.getBody()}`)"
                            }
                        ]
                    },
                    "data" : {
                        "addHeaders" : [ "Access-Control-Allow-Origin" ],
                        "Access-Control-Allow-Origin" : "*"
                    }
                },
                {
                    "stepId" : "mcp.controller",
                    "trigger" : {
                        "timer" : {
                            "period" : 1000
                        }
                    },
                    "resultsProcessor" : {
                        "resource" : "/apps/mcp/controller.js"
                    },
                    "persistenceFile" : "persistenceFile"
                },
                {
                    "enabled" : "true",
                    "stepId" : "greeting",
                    "resultsProcessor" : {
                        "resource" : "/apps/mcp/greeting.js"
                    },
                    "trigger" : {
                        "runOnce": true
                    }
                }
            ]
        }
    ]
}